WITH VBAK AS (
    SELECT * FROM {{ ref('VBAK') }}
),
VBAP AS (
    SELECT * FROM {{ ref('VBAP') }}
),
VBKD AS (
    SELECT * FROM {{ ref('VBKD') }}
)
SELECT
	VBAK.AUDAT AS DOC_DATE,
	VBAK.AUART AS DOC_TYPE,
	VBAK.VKORG AS SALE_ORG,
	VBAK.VTWEG AS DISTRIBUTION_CHANNEL,
	VBAK.SPART AS DIVISION,
	VBAK.VKGRP AS SALE_GROUP,
	VBAK.VKBUR AS SALE_OFFICE,
	VBAK.KUNNR AS CUSTOMER_CODE,
	VBAK.BUKRS_VF AS COMPANY_CODE,
	VBAK.VDATU AS REQUEST_DELIVERY_DATE,
	VBAK.BSTNK AS PO_NUM,
	VBAK.BSTDK AS PO_DATE,
	VBAK.BNAME AS ORDER_NAME,
	VBAK.MAHDT AS LAST_CUSTOMER_CONTACT_DATE,
	VBAK.STWAE AS STAT_CURR,
	VBAK.VGBEL AS REF_DOC,
	VBAP.VGPOS AS REF_ITEM,
	VBAP.VBELN AS DOC_NUM,
	VBAP.POSNR AS DOC_ITEM,
	VBAP.MATNR AS MATERIAL_CODE,
	VBAP.MATKL AS MATERIAL_GRP,
	VBAP.ARKTX AS DESCRIPTION,
	VBAP.PSTYV AS ITEM_CAT,
	VBAP.ABGRU AS REASON_REJECTION,
	VBAP.PRODH AS PROD_HIER,
	VBAP.MEINS AS BUOM,
	VBAP.NETWR AS NET_VALUE,
	VBAP.WAERK AS DOC_CURR,
	VBAP.KWMENG AS QUANTITY,
	VBAP.VRKME AS SALE_UNIT,
	VBAP.WERKS AS PLANT,
	VBAP.LGORT AS STORAGE_LOC,
	VBAP.VSTEL AS SHIP_POINT,
	VBAP.TAXM1 AS TAX_CLASS,
	VBAP.NETPR AS NET_PRICE,
	VBAP.KPEIN AS PRICING_UNIT,
	VBAP.KMEIN AS UOM,
	VBAP.SHKZG AS [RETURN],
	VBAP.KZWI1 AS SUBTOT_1,
	VBAP.KZWI2 AS SUBTOT_2,
	VBAP.KZWI3 AS SUBTOT_3,
	VBAP.KZWI4 AS SUBTOT_4,
	VBAP.KZWI5 AS SUBTOT_5,
	VBAP.KZWI6 AS SUBTOT_6,
	VBAP.STCUR AS EXCHANGE_RATE_STATS,
	VBAP.PRCTR AS PROFIT_CENTER,
	VBAP.AUDAT AS SD_DOC_DATE,
	VBAK.TRVOG AS TRANSACTION_GROUP,
	VBKD.PLTYP AS PRICE_LIST
FROM
	VBAK
	LEFT JOIN VBAP
		ON 1 = 1
		AND VBAP.MANDT = VBAK.MANDT
		AND VBAP.VBELN = VBAK.VBELN
	LEFT JOIN VBKD --Sales Document: Business Data
		ON 1=1
		AND VBAP.MANDT = VBKD.MANDT
		AND VBAP.VBELN = VBKD.VBELN
		AND VBAP.POSNR = VBKD.POSNR