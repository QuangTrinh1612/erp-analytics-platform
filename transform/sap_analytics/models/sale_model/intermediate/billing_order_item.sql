WITH VBRK AS (
    SELECT * FROM {{ ref('VBRK') }}
),
VBRP AS (
    SELECT * FROM {{ ref('VBRP') }}
)
SELECT
	VBRK.VBELN AS BILL_NUM,
	VBRP.POSNR AS BILL_ITEM,
	VBRK.FKDAT AS BILL_DATE,
	VBRK.KUNAG AS SOLD_TO,
	VBRK.KUNWE AS SHIP_TO,
	VBRK.KUNRG AS PAYER,
	VBRK.BUKRS AS COMPANY_CODE,
	VBRK.VTWEG AS DISTR_CHAN,
	VBRK.SPART AS DIVISION,
	VBRK.VKORG AS SALE_ORG,
	VBRP.VKGRP AS SALE_GRP,
	VBRP.VKBUR AS SALE_OFF,
	VBRP.MATNR AS MATERIAL_CODE,
	VBRP.WERKS AS PLANT,
	VBRP.LGORT AS GN_LOCATIO,
	VBRP.VSTEL AS SHIP_POINT,
	VBRP.AUTYP AS IMODOCCAT,
	VBRP.SHKZG AS RETURN_ITEM,
	VBRP.VGPOS AS REF_ITEM,
	VBRP.VGBEL AS REF_DOC,
	VBRK.WAERK AS DOC_CURRCY,
	VBRP.MEINS AS BASE_UOM,
	VBRP.NETWR AS NETVAL_INV,
	VBRP.FKIMG AS QUANT_BUOM,
	VBRP.WAVWR AS COST,
	VBRP.KZWI1 AS SUBTOT_1S,
	VBRP.KZWI2 AS SUBTOT_2S,
	VBRP.KZWI3 AS SUBTOT_3S,
	VBRP.KZWI4 AS SUBTOT_4S,
	VBRP.KZWI5 AS SUBTOT_5S,
	VBRP.KZWI6 AS SUBTOT_6S,
	VBRK.FKSTO AS CANCEL_STATUS,
	VBRK.SFAKN AS CANCEL_BILLING,
	VBRP.TAXM1 AS TAX_CLASSIFICATION_MATERIAL ,
	VBRK.TAXK1 AS TAX_CLASSIFICATION_CUSTOMER,
	VBRP.VGBEL AS DELIVERY_DOC ,
	VBRP.VGPOS AS DELIVERY_ITEM
FROM
	VBRP
	LEFT JOIN VBRK
		ON 1 = 1
		AND VBRP.MANDT = VBRK.MANDT
		AND VBRP.VBELN = VBRK.VBELN